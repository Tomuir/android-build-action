default_platform(:android)

platform :android do
  desc "Assemble debug APK"
  lane :assemble do
    gradle(
      task: ENV["GRADLE_TASK"],
      project_dir: ENV["PROJECT_PATH"],
      flags: "--no-daemon",
    )

    APK_LOCATION = "#{lane_context[SharedValues::GRADLE_APK_OUTPUT_PATH]}"
    sh("cp", "#{APK_LOCATION}", ENV["OUTPUT_PATH"])

    if ENV["BROWSERSTACK_UPLOAD"] == 'true'
      upload_to_browserstack_app_live(
        browserstack_username: ENV["BROWSERSTACK_USERNAME"],
        browserstack_access_key: ENV["BROWSERSTACK_ACCESS_KEY"],
        file_path: ENV["OUTPUT_PATH"]
      )
    end
  end
end
